<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Labirinto Stellato per Bea</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      margin: 0;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background: radial-gradient(circle at top, #0d1b2a, #000000);
      overflow: hidden;
      font-family: 'Arial', sans-serif;
      color: white;
    }

    canvas {
      border: 2px solid white;
      background: transparent;
    }

    .star {
      position: absolute;
      background: white;
      border-radius: 50%;
      opacity: 0.8;
      animation: fall linear infinite;
    }

    @keyframes fall {
      from { transform: translateY(-10vh); }
      to { transform: translateY(110vh); }
    }

    #message {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0);
      font-size: 2em;
      text-align: center;
      color: gold;
      text-shadow: 0 0 15px white, 0 0 30px gold;
      animation: none;
    }

    @keyframes pop {
      0% { transform: translate(-50%, -50%) scale(0); }
      60% { transform: translate(-50%, -50%) scale(1.2); }
      100% { transform: translate(-50%, -50%) scale(1); }
    }
  </style>
</head>
<body>
  <canvas id="maze" width="360" height="480"></canvas>
  <div id="message">Sei la mia luce nel buio, Bea ðŸ’«</div>

  <script>
    const canvas = document.getElementById("maze");
    const ctx = canvas.getContext("2d");

    const maze = [
      "####################",
      "#S   #         #   #",
      "# # ### ###### # # #",
      "# #     #      # # #",
      "# ### # # ###### # #",
      "#     #   #      # #",
      "##### ##### ###### #",
      "#     #     #      #",
      "# ### # ### # ######",
      "# #   #   # #      #",
      "# # ##### # ###### #",
      "# #     # #      # #",
      "# ##### # ###### # #",
      "#     # #      #   #",
      "##### # ###########E",
      "####################",
    ];

    const tileSize = 30;
    let player = { x: 1, y: 1 };
    let goal = { x: 18, y: 14 };

    function drawMaze() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      for (let y = 0; y < maze.length; y++) {
        for (let x = 0; x < maze[y].length; x++) {
          if (maze[y][x] === "#") {
            ctx.fillStyle = "rgba(255,255,255,0.2)";
            ctx.strokeStyle = "#5dade2";
            ctx.lineWidth = 2;
            ctx.strokeRect(x * tileSize, y * tileSize, tileSize, tileSize);
          }
        }
      }

      // Giocatore = stellina
      ctx.fillStyle = "gold";
      ctx.beginPath();
      ctx.arc(
        player.x * tileSize + tileSize / 2,
        player.y * tileSize + tileSize / 2,
        tileSize / 2.5,
        0,
        Math.PI * 2
      );
      ctx.fill();

      // Uscita = luna
      ctx.fillStyle = "silver";
      ctx.beginPath();
      ctx.arc(
        goal.x * tileSize + tileSize / 2,
        goal.y * tileSize + tileSize / 2,
        tileSize / 2.5,
        0,
        Math.PI * 2
      );
      ctx.fill();
      ctx.fillStyle = "#0d1b2a";
      ctx.beginPath();
      ctx.arc(
        goal.x * tileSize + tileSize / 2 - 5,
        goal.y * tileSize + tileSize / 2 - 5,
        tileSize / 2.5,
        0,
        Math.PI * 2
      );
      ctx.fill();
    }

    function move(dx, dy) {
      const newX = player.x + dx;
      const newY = player.y + dy;
      if (maze[newY][newX] !== "#") {
        player.x = newX;
        player.y = newY;
        drawMaze();
        checkWin();
      }
    }

    function checkWin() {
      if (player.x === goal.x && player.y === goal.y) {
        const message = document.getElementById("message");
        message.style.animation = "pop 1s forwards";
      }
    }

    document.addEventListener("keydown", (e) => {
      if (e.key === "ArrowUp") move(0, -1);
      if (e.key === "ArrowDown") move(0, 1);
      if (e.key === "ArrowLeft") move(-1, 0);
      if (e.key === "ArrowRight") move(1, 0);
    });

    // Controlli touch (swipe)
    let startX, startY;
    document.addEventListener("touchstart", (e) => {
      startX = e.touches[0].clientX;
      startY = e.touches[0].clientY;
    });
    document.addEventListener("touchend", (e) => {
      let dx = e.changedTouches[0].clientX - startX;
      let dy = e.changedTouches[0].clientY - startY;
      if (Math.abs(dx) > Math.abs(dy)) {
        if (dx > 30) move(1, 0);
        if (dx < -30) move(-1, 0);
      } else {
        if (dy > 30) move(0, 1);
        if (dy < -30) move(0, -1);
      }
    });

    drawMaze();

    // Effetto stelline cadenti
    function createStar() {
      const star = document.createElement("div");
      star.classList.add("star");
      const size = Math.random() * 3 + 2;
      star.style.width = size + "px";
      star.style.height = size + "px";
      star.style.left = Math.random() * 100 + "vw";
      star.style.animationDuration = (Math.random() * 5 + 5) + "s";
      document.body.appendChild(star);
      setTimeout(() => star.remove(), 10000);
    }
    setInterval(createStar, 200);
  </script>
</body>
</html>
