<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Labirinto Romantico per Bea</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      margin: 0;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      background: radial-gradient(circle at top, #2c003e, #0b0014);
      overflow: hidden;
      font-family: 'Arial', sans-serif;
      color: white;
    }

    canvas {
      border: 2px solid #ffb6c1;
      background: transparent;
      box-shadow: 0 0 15px rgba(255, 182, 193, 0.6);
    }

    .heart, .star {
      position: absolute;
      border-radius: 50%;
      opacity: 0.8;
      animation: fall linear infinite;
    }

    .heart {
      background: pink;
      width: 12px;
      height: 12px;
      transform: rotate(45deg);
    }
    .heart::before,
    .heart::after {
      content: "";
      position: absolute;
      width: 12px;
      height: 12px;
      background: pink;
      border-radius: 50%;
    }
    .heart::before { top: -6px; left: 0; }
    .heart::after { left: -6px; top: 0; }

    .star {
      background: white;
      width: 3px;
      height: 3px;
    }

    @keyframes fall {
      from { transform: translateY(-10vh); }
      to { transform: translateY(110vh); }
    }

    #message {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0);
      font-size: 2em;
      text-align: center;
      color: #ff99cc;
      text-shadow: 0 0 15px #fff, 0 0 30px #ff99cc;
      animation: none;
    }

    @keyframes pop {
      0% { transform: translate(-50%, -50%) scale(0); }
      60% { transform: translate(-50%, -50%) scale(1.2); }
      100% { transform: translate(-50%, -50%) scale(1); }
    }
  </style>
</head>
<body>
  <canvas id="maze" width="360" height="480"></canvas>
  <div id="message">Hai trovato la via del mio cuore, Bea ❤️✨</div>

  <script>
    const canvas = document.getElementById("maze");
    const ctx = canvas.getContext("2d");

    const maze = [
      "####################",
      "#S   #         #   #",
      "# # ### ###### # # #",
      "# #     #      # # #",
      "# ### # # ###### # #",
      "#     #   #      # #",
      "##### ##### ###### #",
      "#     #     #      #",
      "# ### # ### # ######",
      "# #   #   # #      #",
      "# # ##### # ###### #",
      "# #     # #      # #",
      "# ##### # ###### # #",
      "#     # #      #   #",
      "##### # ###########E",
      "####################",
    ];

    const tileSize = 30;
    let player = { x: 1, y: 1 };
    let goal = { x: 18, y: 14 };

    function drawMaze() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      for (let y = 0; y < maze.length; y++) {
        for (let x = 0; x < maze[y].length; x++) {
          if (maze[y][x] === "#") {
            ctx.strokeStyle = "rgba(255,182,193,0.5)";
            ctx.strokeRect(x * tileSize, y * tileSize, tileSize, tileSize);
          }
        }
      }

      // Giocatore = cuore
      ctx.fillStyle = "red";
      ctx.beginPath();
      ctx.moveTo(player.x * tileSize + tileSize/2, player.y * tileSize + tileSize/1.5);
      ctx.bezierCurveTo(
        player.x * tileSize + tileSize*1.5, player.y * tileSize,
        player.x * tileSize - tileSize/2, player.y * tileSize,
        player.x * tileSize + tileSize/2, player.y * tileSize + tileSize/1.5
      );
      ctx.fill();

      // Uscita = cuore rosa grande
      ctx.fillStyle = "pink";
      ctx.beginPath();
      ctx.moveTo(goal.x * tileSize + tileSize/2, goal.y * tileSize + tileSize/1.5);
      ctx.bezierCurveTo(
        goal.x * tileSize + tileSize*1.5, goal.y * tileSize,
        goal.x * tileSize - tileSize/2, goal.y * tileSize,
        goal.x * tileSize + tileSize/2, goal.y * tileSize + tileSize/1.5
      );
      ctx.fill();
    }

    function move(dx, dy) {
      const newX = player.x + dx;
      const newY = player.y + dy;
      if (maze[newY][newX] !== "#") {
        player.x = newX;
        player.y = newY;
        drawMaze();
        checkWin();
      }
    }

    function checkWin() {
      if (player.x === goal.x && player.y === goal.y) {
        const message = document.getElementById("message");
        message.style.animation = "pop 1s forwards";
      }
    }

    document.addEventListener("keydown", (e) => {
      if (e.key === "ArrowUp") move(0, -1);
      if (e.key === "ArrowDown") move(0, 1);
      if (e.key === "ArrowLeft") move(-1, 0);
      if (e.key === "ArrowRight") move(1, 0);
    });

    // Swipe da telefono
    let startX, startY;
    document.addEventListener("touchstart", (e) => {
      startX = e.touches[0].clientX;
      startY = e.touches[0].clientY;
    });
    document.addEventListener("touchend", (e) => {
      let dx = e.changedTouches[0].clientX - startX;
      let dy = e.changedTouches[0].clientY - startY;
      if (Math.abs(dx) > Math.abs(dy)) {
        if (dx > 30) move(1, 0);
        if (dx < -30) move(-1, 0);
      } else {
        if (dy > 30) move(0, 1);
        if (dy < -30) move(0, -1);
      }
    });

    drawMaze();

    // Effetto stelline + cuoricini
    function createFalling() {
      const el = document.createElement("div");
      el.classList.add(Math.random() > 0.5 ? "star" : "heart");
      el.style.left = Math.random() * 100 + "vw";
      el.style.animationDuration = (Math.random() * 5 + 5) + "s";
      document.body.appendChild(el);
      setTimeout(() => el.remove(), 10000);
    }
    setInterval(createFalling, 300);
  </script>
</body>
</html>
